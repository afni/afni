#!/bin/tcsh -f

#Check R's version
set Rvermin = 2.7    #lowest R version allowed
set Rver = `R --version`
set rsort = `printf "$Rvermin\n$Rver[3]\n" | sort`
if ("rsort[1]" != "$Rvermin") then 
   echo "R version must be $Rvermin or newer"
   echo "You have: $Rver[1-3]"
   exit 1
endif

#set flags for R options and create a little Makefile header

set RccCOMcpp = `R CMD config --cppflags`
set RccCOMlfl = `R CMD config --ldflags`
set RccCOMcfl = `R CMD config CFLAGS`
set RccCOMcc  = `R CMD config CC`
set RCC = $RccCOMcc[1]
set RccCOMcc = ($RccCOMcc[2-$#RccCOMcc])
set RccCOM = "$RCC ${RccCOMcc} ${RccCOMcpp} ${RccCOMcfl}"

#Setup an R Makefile
echo "#This file is automatically generated by script `basename $0`" \
   >  Makefile.R.INCLUDE

echo "#Local R version is $Rver[1-3]" >> Makefile.R.INCLUDE
echo "#Compile options"
echo "RccCOMcpp = ${RccCOMcpp}"  >> Makefile.R.INCLUDE
echo "RccCOMlfl = ${RccCOMlfl}"  >> Makefile.R.INCLUDE
echo "RccCOMcfl = ${RccCOMcfl}"  >> Makefile.R.INCLUDE
echo "RccCOMcc  = ${RccCOMcc}"   >> Makefile.R.INCLUDE
echo 'RccCOMopt = $(RccCOMcc) $(RccCOMcpp) $(RccCOMcfl)'   >> Makefile.R.INCLUDE
echo ""
